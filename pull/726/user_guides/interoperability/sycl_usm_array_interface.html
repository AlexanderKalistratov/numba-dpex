<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zero copy data exchange using SYCL USM &mdash; numba-dppy 0+untagged.732.g0dfcf9f documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="numba-dppy For numba.cuda Developers" href="../migrating_from_numba_cuda.html" />
    <link rel="prev" title="Common issues and tips" href="../debugging/common_issues.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> numba-dppy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Core Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CoreFeatures.html">Code-generation based on a device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CoreFeatures.html#automatic-offload-of-numpy-expressions">Automatic offload of NumPy expressions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html"> Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel_programming_guide/index.html"> Programming SYCL Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debugging/index.html"> Debugging with GDB</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"> SYCL USM Array Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#sycl-usm-array-interface">SYCL USM Array Interface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../migrating_from_numba_cuda.html"> numba-dppy for numba.cuda Programmers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guides/dpnp_integration.html">DPNP integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guides/tools.html">Debugging the compilation pipeline</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">numba-dppy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Zero copy data exchange using SYCL USM</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/user_guides/interoperability/sycl_usm_array_interface.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="zero-copy-data-exchange-using-sycl-usm">
<h1>Zero copy data exchange using SYCL USM<a class="headerlink" href="#zero-copy-data-exchange-using-sycl-usm" title="Permalink to this headline"></a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This page originally posted in dpctl wiki
<a class="reference external" href="https://github.com/IntelPython/dpctl/wiki/Zero-copy-data-exchange-using-SYCL-USM">Zero copy data exchange using SYCL USM</a>.</p>
</div>
<p>Dpctl includes a DPC++ USM memory manager to allow Python objects to be
allocated using USM memory allocators. Supporting USM memory allocators is
needed to achieve seamless interoperability between SYCL-based Python
extensions. USM pointers make sense within a SYCL context and can be of four
allocation types: <cite>“host”</cite>, <cite>“device”</cite>, <cite>“shared”</cite>, or <cite>“unknown”</cite>. Host
applications, including CPython interpreter, can work with USM pointers of type
<cite>host</cite> and <cite>“shared”</cite> as if they were ordinary host pointers. Accessing
<cite>“device”</cite> USM pointers by host applications is not allowed.</p>
<section id="sycl-usm-array-interface">
<span id="sycl-usm-arrays-interface"></span><h2>SYCL USM Array Interface<a class="headerlink" href="#sycl-usm-array-interface" title="Permalink to this headline"></a></h2>
<p>A SYCL library may allocate USM memory for the result that needs to be passed to
Python. A native Python extension that makes use of such a library may expose
this memory as an instance of Python class that will implement memory management
logic (ensures that memory is freed when the instance is no longer needed). The
need to manage memory arises whenever a library uses a custom allocator. For
example, <cite>daal4py</cite> uses Python capsule to ensure that DAAL-allocated memory is
freed using the appropriate deallocator.</p>
<p>To enable native extensions to pass the memory allocated by a native SYCL
library to Numba, or another SYCL-aware Python extension without making a copy,
the class must provide <cite>__sycl_usm_array_interface__</cite> attribute which returns a
Python dictionary with the following fields:</p>
<dl class="py data">
<dt class="sig sig-object py" id="object.__sycl_usm_array_interface__">
<span class="sig-prename descclassname"><span class="pre">object.</span></span><span class="sig-name descname"><span class="pre">__sycl_usm_array_interface__</span></span><a class="headerlink" href="#object.__sycl_usm_array_interface__" title="Permalink to this definition"></a></dt>
<dd><p>A dictionary of items.</p>
<p>The keys are:</p>
<dl class="simple">
<dt><strong>shape</strong></dt><dd><p>tuple of integers</p>
</dd>
<dt><strong>typestr</strong></dt><dd><p>string</p>
</dd>
<dt><strong>typedescr</strong></dt><dd><p>a list of tuples</p>
</dd>
<dt><strong>data</strong></dt><dd><p>(int, bool)</p>
<ul class="simple">
<li><p><cite>data[0]</cite> is to be understood as <cite>static_cast&lt;size_t&gt;(usm_ptr)</cite></p></li>
<li><p><cite>data[1]</cite> is a boolean value indicating whether the array is read-only, or
not.</p></li>
</ul>
</dd>
<dt><strong>strides</strong></dt><dd><p>tuple</p>
</dd>
<dt><strong>offset</strong></dt><dd><p>int</p>
</dd>
<dt><strong>version</strong></dt><dd><p>int</p>
</dd>
<dt><strong>syclobj</strong></dt><dd><p>A Python object indicating context to which USM pointer is bound</p>
<ul class="simple">
<li><p>filter selector string: default context for this root device is used</p></li>
<li><p><cite>dpctl.SyclContext</cite>: explicitly given context</p></li>
<li><p>named Python capsule with name “SyclContextRef” that carries pointer to
<cite>sycl::context</cite> to use</p></li>
<li><p><cite>dpctl.SyclQueue</cite>  : use context stored in the queue</p></li>
<li><p>named Python capsule with name “SyclQueueRef” that carries pointer to
<cite>sycl::queue</cite> from which to use the context</p></li>
<li><p>Any Python object with method <cite>_get_capsule()</cite> that produces a named
Python capsule as described above.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p>The dictionary keys align with those of <a class="reference external" href="https://numpy.org/doc/stable/reference/arrays.interface.html#python-side">NumPy Array Interface</a> and
<a class="reference external" href="http://numba.pydata.org/numba-doc/latest/cuda/cuda_array_interface.html">CUDA Array Interface</a>. For host accessible USM pointers, the object may also
implement CPython <span class="target" id="index-0"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3118"><strong>PEP 3118</strong></a> compliant buffer interface which will be used
if a <cite>data</cite> key is not present in the dictionary. Use of a buffer interface
extends the interoperability to other Python objects, such as <cite>bytes</cite>,
<cite>bytearray</cite>, <cite>array.array</cite>, or <cite>memoryview</cite>. The type of the USM pointer stored
in the object can be queried using methods of the <cite>dpctl</cite>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../debugging/common_issues.html" class="btn btn-neutral float-left" title="Common issues and tips" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../migrating_from_numba_cuda.html" class="btn btn-neutral float-right" title="numba-dppy For numba.cuda Developers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Intel.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>